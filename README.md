# Сервис уведомлений для Docsvision

## Постановка задачи

### Цель проекта
Разработка универсального расширяемого REST API сервиса уведомлений для системы документооборота Docsvision.

### Основные требования

#### Типы уведомлений
1. **О создании задания исполнителю**
   - Автор задания
   - Тема задания
   - Описание задания
   - Тип задания
   - Плановый срок исполнения
   - Дата создания задания

2. **О завершении задания автору**
   - Исполнитель задания
   - Тема задания
   - Описание задания
   - Тип задания
   - Фактическая дата завершения
   - Дата создания задания

#### Структура уведомления
- Дата создания уведомления
- Тема уведомления
- Категория уведомления
- Краткое описание
- Флаг прочтения
- Полезная нагрузка (payload) для каждого типа

#### Каналы доставки
- Приоритетный: электронная почта
- Дополнительный: хранение в БД SQLite
- Возможность получения уведомлений по запросу пользователя

#### Функциональные требования
- Гибкое добавление новых типов уведомлений
- Настройка шаблонов для email
- Получение данных пользователей из различных источников
- Расширяемая архитектура

## Архитектура сервиса

### Общая схема
```
┌─────────────────┐    ┌──────────────────┐    ┌─────────────────┐
│   REST API      │────│   Notification   │────│   Data Access   │
│   Controllers   │    │     Services     │    │      Layer      │
└─────────────────┘    └──────────────────┘    └─────────────────┘
         │                       │                       │
         │                       │                       │
┌─────────────────┐    ┌──────────────────┐    ┌─────────────────┐
│  Email Service  │    │ Template Engine  │    │   SQLite DB     │
└─────────────────┘    └──────────────────┘    └─────────────────┘
         │                       │
         │                       │
┌─────────────────┐    ┌──────────────────┐
│  SMTP Server    │    │ User Providers   │
└─────────────────┘    └──────────────────┘
```

### Основные компоненты

#### 1. Модели данных
- `Notification` - базовая модель уведомления
- `TaskCreatedNotification` - уведомление о создании задания
- `TaskCompletedNotification` - уведомление о завершении задания
- `User` - модель пользователя
- `NotificationTemplate` - шаблоны уведомлений

#### 2. Сервисы
- `INotificationService` - основной сервис уведомлений
- `IEmailService` - сервис отправки email
- `ITemplateService` - сервис работы с шаблонами
- `IUserProvider` - провайдер данных пользователей

#### 3. Контроллеры
- `NotificationsController` - управление уведомлениями
- `TemplatesController` - управление шаблонами
- `UsersController` - получение данных пользователей

#### 4. Провайдеры данных
- Внутренняя база данных
- Внешние источники (API Docsvision)

### Технологический стек
- .NET 8
- ASP.NET Core Web API
- Entity Framework Core
- SQLite
- System.Net.Mail (для email)
- xUnit (для тестирования)

## Примеры HTML-шаблонов

### Уведомление о создании задания
```html
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Новое задание</title>
</head>
<body>
    <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;">
        <h2 style="color: #2c3e50;">Новое задание</h2>
        <div style="background: #f8f9fa; padding: 15px; border-radius: 5px;">
            <p><strong>Автор:</strong> {{AuthorName}}</p>
            <p><strong>Тема:</strong> {{TaskSubject}}</p>
            <p><strong>Описание:</strong> {{TaskDescription}}</p>
            <p><strong>Тип задания:</strong> {{TaskType}}</p>
            <p><strong>Плановый срок:</strong> {{DueDate}}</p>
            <p><strong>Дата создания:</strong> {{CreatedDate}}</p>
        </div>
        <p style="color: #7f8c8d; font-size: 12px;">
            Это уведомление было отправлено автоматически.
        </p>
    </div>
</body>
</html>
```

### Уведомление о завершении задания
```html
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Задание завершено</title>
</head>
<body>
    <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;">
        <h2 style="color: #27ae60;">Задание завершено</h2>
        <div style="background: #f8f9fa; padding: 15px; border-radius: 5px;">
            <p><strong>Исполнитель:</strong> {{ExecutorName}}</p>
            <p><strong>Тема:</strong> {{TaskSubject}}</p>
            <p><strong>Описание:</strong> {{TaskDescription}}</p>
            <p><strong>Тип задания:</strong> {{TaskType}}</p>
            <p><strong>Фактическая дата завершения:</strong> {{CompletionDate}}</p>
            <p><strong>Дата создания:</strong> {{CreatedDate}}</p>
        </div>
        <p style="color: #7f8c8d; font-size: 12px;">
            Это уведомление было отправлено автоматически.
        </p>
    </div>
</body>
</html>
```

## Принципы разработки

### SOLID принципы
- **S** - каждый компонент имеет одну ответственность
- **O** - система открыта для расширения, закрыта для модификации
- **L** - наследники могут использоваться вместо родителей
- **I** - интерфейсы разделены по функциональности
- **D** - зависимости от абстракций, а не от реализаций

### DRY и KISS
- Повторяющийся код вынесен в общие компоненты
- Простые и понятные решения
- Минимальное количество зависимостей

### Модульность
- Каждый компонент в отдельном файле
- Четкое разделение ответственности
- Легкость тестирования и замены компонентов

## Следующие шаги
1. Создание структуры проекта и моделей данных
2. Реализация базового API
3. Разработка сервисов уведомлений
4. Интеграция с email
5. Создание шаблонов
6. Тестирование